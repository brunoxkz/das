<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Completo - Notifica√ß√µes PWA</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #22c55e;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo {
            color: #22c55e;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #888;
            font-size: 1.2em;
        }
        .status-container {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-button {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
        }
        .test-button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .log-container {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
        }
        .log-success { color: #22c55e; }
        .log-error { color: #ef4444; }
        .log-warning { color: #f59e0b; }
        .log-info { color: #3b82f6; }
        .log-debug { color: #8b5cf6; }
        .clear-button {
            background: #ef4444;
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        .device-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .device-info h3 {
            color: #3b82f6;
            margin: 0 0 10px 0;
        }
        .permission-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 12px;
        }
        .status-granted { background: #22c55e; color: white; }
        .status-denied { background: #ef4444; color: white; }
        .status-default { background: #f59e0b; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîî VENDZZ</div>
            <div class="subtitle">Sistema de Teste de Notifica√ß√µes PWA</div>
        </div>

        <div class="device-info">
            <h3>üì± Informa√ß√µes do Dispositivo</h3>
            <div id="deviceInfo">Carregando...</div>
        </div>

        <div class="status-container">
            <h3>üîî Status das Notifica√ß√µes</h3>
            <div>
                <strong>Suporte:</strong> <span id="notificationSupport">Verificando...</span><br>
                <strong>Permiss√£o:</strong> <span id="permissionStatus">Verificando...</span><br>
                <strong>PWA Mode:</strong> <span id="pwaMode">Verificando...</span><br>
                <strong>Service Worker:</strong> <span id="swStatus">Verificando...</span>
            </div>
        </div>

        <div class="status-container">
            <h3>üß™ Testes de Notifica√ß√£o</h3>
            <button class="test-button" onclick="requestPermission()">üìã Solicitar Permiss√£o</button>
            <button class="test-button" onclick="sendTestNotification()">üîî Enviar Teste</button>
            <button class="test-button" onclick="sendWelcomeNotification()">üëã Notifica√ß√£o de Boas-Vindas</button>
            <button class="test-button" onclick="testMultipleNotifications()">üì¢ M√∫ltiplas Notifica√ß√µes</button>
            <button class="test-button" onclick="testPersistentNotification()">üìå Notifica√ß√£o Persistente</button>
            <button class="test-button" onclick="runFullTest()">üöÄ Teste Completo</button>
        </div>

        <div class="status-container">
            <h3>üìä Log de Debug</h3>
            <button class="clear-button" onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
            <div class="log-container" id="logContainer"></div>
        </div>
    </div>

    <script>
        // Sistema de logs com cores
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Logs limpos', 'info');
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            addLog('üöÄ Sistema de teste inicializado', 'success');
            updateDeviceInfo();
            updateNotificationStatus();
            
            // Registrar Service Worker se dispon√≠vel
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(() => {
                        addLog('‚úÖ Service Worker registrado', 'success');
                        updateNotificationStatus();
                    })
                    .catch(err => {
                        addLog(`‚ùå Erro ao registrar Service Worker: ${err.message}`, 'error');
                    });
            }
        });

        function updateDeviceInfo() {
            const deviceInfo = document.getElementById('deviceInfo');
            const info = [
                `<strong>User Agent:</strong> ${navigator.userAgent}`,
                `<strong>Platform:</strong> ${navigator.platform}`,
                `<strong>Linguagem:</strong> ${navigator.language}`,
                `<strong>Cookies Habilitados:</strong> ${navigator.cookieEnabled ? 'Sim' : 'N√£o'}`,
                `<strong>Online:</strong> ${navigator.onLine ? 'Sim' : 'N√£o'}`,
                `<strong>Tela:</strong> ${screen.width}x${screen.height}`,
                `<strong>Viewport:</strong> ${window.innerWidth}x${window.innerHeight}`
            ];
            deviceInfo.innerHTML = info.join('<br>');
            
            addLog(`üì± Dispositivo detectado: ${navigator.platform}`, 'info');
            addLog(`üìê Resolu√ß√£o: ${screen.width}x${screen.height}`, 'debug');
        }

        function updateNotificationStatus() {
            // Verificar suporte
            const supportElement = document.getElementById('notificationSupport');
            const permissionElement = document.getElementById('permissionStatus');
            const pwaElement = document.getElementById('pwaMode');
            const swElement = document.getElementById('swStatus');

            if ('Notification' in window) {
                supportElement.innerHTML = '<span style="color: #22c55e;">‚úÖ Suportado</span>';
                addLog('‚úÖ Notifica√ß√µes s√£o suportadas', 'success');
            } else {
                supportElement.innerHTML = '<span style="color: #ef4444;">‚ùå N√£o Suportado</span>';
                addLog('‚ùå Notifica√ß√µes N√ÉO s√£o suportadas', 'error');
                return;
            }

            // Verificar permiss√£o
            const permission = Notification.permission;
            let permissionClass = '';
            let permissionIcon = '';
            
            switch(permission) {
                case 'granted':
                    permissionClass = 'status-granted';
                    permissionIcon = '‚úÖ';
                    addLog('‚úÖ Permiss√£o concedida', 'success');
                    break;
                case 'denied':
                    permissionClass = 'status-denied';
                    permissionIcon = '‚ùå';
                    addLog('‚ùå Permiss√£o negada', 'error');
                    break;
                case 'default':
                    permissionClass = 'status-default';
                    permissionIcon = '‚ö†Ô∏è';
                    addLog('‚ö†Ô∏è Permiss√£o pendente', 'warning');
                    break;
            }
            
            permissionElement.innerHTML = `<span class="permission-status ${permissionClass}">${permissionIcon} ${permission.toUpperCase()}</span>`;

            // Verificar PWA mode
            const isPWA = window.matchMedia('(display-mode: standalone)').matches;
            pwaElement.innerHTML = isPWA ? 
                '<span style="color: #22c55e;">‚úÖ PWA Ativo</span>' : 
                '<span style="color: #f59e0b;">‚ö†Ô∏è Navegador</span>';
            
            addLog(`üì± Modo PWA: ${isPWA ? 'Ativo' : 'Inativo'}`, isPWA ? 'success' : 'warning');

            // Verificar Service Worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(() => {
                    swElement.innerHTML = '<span style="color: #22c55e;">‚úÖ Ativo</span>';
                    addLog('‚úÖ Service Worker ativo', 'success');
                }).catch(() => {
                    swElement.innerHTML = '<span style="color: #ef4444;">‚ùå Erro</span>';
                    addLog('‚ùå Service Worker com erro', 'error');
                });
            } else {
                swElement.innerHTML = '<span style="color: #ef4444;">‚ùå N√£o Suportado</span>';
                addLog('‚ùå Service Worker n√£o suportado', 'error');
            }
        }

        async function requestPermission() {
            addLog('üîî Solicitando permiss√£o de notifica√ß√£o...', 'info');
            
            if (!('Notification' in window)) {
                addLog('‚ùå Notifica√ß√µes n√£o suportadas', 'error');
                return;
            }

            if (Notification.permission === 'granted') {
                addLog('‚úÖ Permiss√£o j√° concedida', 'success');
                return;
            }

            try {
                let permission;
                
                addLog(`üîß M√©todo requestPermission: ${typeof Notification.requestPermission}`, 'debug');
                addLog(`üîß Length: ${Notification.requestPermission.length}`, 'debug');
                
                if (Notification.requestPermission.length) {
                    // M√©todo callback (iOS)
                    addLog('üì± Usando m√©todo callback (iOS)', 'debug');
                    permission = await new Promise((resolve) => {
                        Notification.requestPermission((result) => {
                            addLog(`üì± Callback result: ${result}`, 'debug');
                            resolve(result);
                        });
                    });
                } else {
                    // M√©todo Promise (navegadores modernos)
                    addLog('üñ•Ô∏è Usando m√©todo Promise (moderno)', 'debug');
                    permission = await Notification.requestPermission();
                }

                addLog(`üîî Resultado da permiss√£o: ${permission}`, 'info');

                if (permission === 'granted') {
                    addLog('‚úÖ Permiss√£o concedida com sucesso!', 'success');
                } else if (permission === 'denied') {
                    addLog('‚ùå Permiss√£o negada pelo usu√°rio', 'error');
                } else {
                    addLog('‚ö†Ô∏è Permiss√£o n√£o definida', 'warning');
                }

                updateNotificationStatus();
            } catch (error) {
                addLog(`‚ùå Erro ao solicitar permiss√£o: ${error.message}`, 'error');
                addLog(`‚ùå Stack: ${error.stack}`, 'debug');
            }
        }

        function sendTestNotification() {
            addLog('üß™ Enviando notifica√ß√£o de teste...', 'info');
            
            if (Notification.permission !== 'granted') {
                addLog('‚ùå Permiss√£o n√£o concedida', 'error');
                return;
            }

            try {
                const notification = new Notification('üß™ Teste Vendzz', {
                    body: 'Esta √© uma notifica√ß√£o de teste do sistema Vendzz.',
                    icon: '/vendzz-logo-official.png',
                    badge: '/vendzz-logo-official.png',
                    tag: 'test',
                    requireInteraction: false
                });

                notification.onclick = () => {
                    addLog('üëÜ Notifica√ß√£o clicada', 'info');
                    notification.close();
                };

                notification.onshow = () => {
                    addLog('‚úÖ Notifica√ß√£o exibida', 'success');
                };

                notification.onerror = (error) => {
                    addLog(`‚ùå Erro na notifica√ß√£o: ${error}`, 'error');
                };

                // Fechar ap√≥s 5 segundos
                setTimeout(() => {
                    notification.close();
                    addLog('üîï Notifica√ß√£o fechada automaticamente', 'info');
                }, 5000);

            } catch (error) {
                addLog(`‚ùå Erro ao criar notifica√ß√£o: ${error.message}`, 'error');
            }
        }

        function sendWelcomeNotification() {
            addLog('üëã Enviando notifica√ß√£o de boas-vindas...', 'info');
            
            if (Notification.permission !== 'granted') {
                addLog('‚ùå Permiss√£o n√£o concedida', 'error');
                return;
            }

            try {
                const notification = new Notification('üëã Vendzz - Bem-vindo!', {
                    body: 'Notifica√ß√µes ativadas com sucesso. Voc√™ receber√° updates importantes.',
                    icon: '/vendzz-logo-official.png',
                    badge: '/vendzz-logo-official.png',
                    tag: 'welcome',
                    requireInteraction: false,
                    actions: [
                        { action: 'view', title: 'Ver Dashboard' },
                        { action: 'dismiss', title: 'Dispensar' }
                    ]
                });

                notification.onclick = () => {
                    addLog('üëÜ Notifica√ß√£o de boas-vindas clicada', 'info');
                    notification.close();
                };

                addLog('‚úÖ Notifica√ß√£o de boas-vindas enviada', 'success');

            } catch (error) {
                addLog(`‚ùå Erro ao criar notifica√ß√£o de boas-vindas: ${error.message}`, 'error');
            }
        }

        function testMultipleNotifications() {
            addLog('üì¢ Testando m√∫ltiplas notifica√ß√µes...', 'info');
            
            if (Notification.permission !== 'granted') {
                addLog('‚ùå Permiss√£o n√£o concedida', 'error');
                return;
            }

            const notifications = [
                { title: 'üìä Nova campanha criada', body: 'Sua campanha SMS foi criada com sucesso.' },
                { title: 'üìà Relat√≥rio dispon√≠vel', body: 'Relat√≥rio mensal de convers√µes pronto.' },
                { title: 'üéØ Meta atingida', body: 'Parab√©ns! Voc√™ atingiu 100 leads hoje.' }
            ];

            notifications.forEach((notif, index) => {
                setTimeout(() => {
                    try {
                        const notification = new Notification(notif.title, {
                            body: notif.body,
                            icon: '/vendzz-logo-official.png',
                            tag: `multi-${index}`
                        });
                        
                        addLog(`‚úÖ Notifica√ß√£o ${index + 1}/3 enviada`, 'success');
                    } catch (error) {
                        addLog(`‚ùå Erro na notifica√ß√£o ${index + 1}: ${error.message}`, 'error');
                    }
                }, index * 2000);
            });
        }

        function testPersistentNotification() {
            addLog('üìå Testando notifica√ß√£o persistente...', 'info');
            
            if (Notification.permission !== 'granted') {
                addLog('‚ùå Permiss√£o n√£o concedida', 'error');
                return;
            }

            try {
                const notification = new Notification('üìå Notifica√ß√£o Persistente', {
                    body: 'Esta notifica√ß√£o n√£o ser√° fechada automaticamente.',
                    icon: '/vendzz-logo-official.png',
                    tag: 'persistent',
                    requireInteraction: true,
                    actions: [
                        { action: 'close', title: 'Fechar' },
                        { action: 'snooze', title: 'Adiar' }
                    ]
                });

                notification.onclick = () => {
                    addLog('üëÜ Notifica√ß√£o persistente clicada', 'info');
                };

                addLog('‚úÖ Notifica√ß√£o persistente criada', 'success');

            } catch (error) {
                addLog(`‚ùå Erro ao criar notifica√ß√£o persistente: ${error.message}`, 'error');
            }
        }

        async function runFullTest() {
            addLog('üöÄ Iniciando teste completo...', 'info');
            clearLogs();
            
            // Atualizar status
            updateNotificationStatus();
            
            // Solicitar permiss√£o se necess√°rio
            if (Notification.permission === 'default') {
                await requestPermission();
            }
            
            if (Notification.permission === 'granted') {
                addLog('‚úÖ Permiss√£o OK - Executando testes...', 'success');
                
                // Teste b√°sico
                setTimeout(() => sendTestNotification(), 1000);
                
                // Teste de boas-vindas
                setTimeout(() => sendWelcomeNotification(), 3000);
                
                // M√∫ltiplas notifica√ß√µes
                setTimeout(() => testMultipleNotifications(), 6000);
                
                addLog('üéâ Teste completo agendado', 'success');
            } else {
                addLog('‚ùå N√£o √© poss√≠vel executar teste completo sem permiss√£o', 'error');
            }
        }

        // Monitorar mudan√ßas de permiss√£o
        if ('permissions' in navigator) {
            navigator.permissions.query({name: 'notifications'}).then((permission) => {
                permission.addEventListener('change', () => {
                    addLog(`üîÑ Permiss√£o alterada para: ${permission.state}`, 'info');
                    updateNotificationStatus();
                });
            });
        }

        // Monitorar visibilidade da p√°gina
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') {
                addLog('üëÄ P√°gina ficou vis√≠vel', 'debug');
                updateNotificationStatus();
            } else {
                addLog('üôà P√°gina ficou oculta', 'debug');
            }
        });

        // Adicionar log inicial
        addLog('üîî Sistema de teste de notifica√ß√µes carregado', 'success');
    </script>
</body>
</html>